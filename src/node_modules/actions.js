// import {actionCreator, createTypes} from 'redux-action-creator';

const types = {
  SAVE_IMG_ADDRS: 'SAVE_IMG_ADDRS',
  LOAD_IMAGES: 'LOAD_IMAGES',
  SET_GALLERY_ID: 'SET_GALLERY_ID'
}

function saveImgAddrs (addrs) {
  return {
    type: types.SAVE_IMG_ADDRS,
    addrs
  }
}

function loadImages () {
  return {
    type: types.LOAD_IMAGES
  }
}

function setGalleryId(galleryId) {
  return {
    type: types.SET_GALLERY_ID,
    galleryId
  }
}

function shuffle(a) {
    for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
    }
}

function fetchImgAddr (galleryId) {
  return function (dispatch) {
    if(galleryId !== undefined) return fetch('http://localhost:8080/gallery/'+ galleryId)
      .then(
        response => response.json(),
        error => console.log('An error occured.', error)
      )
      .then(json => {
        dispatch(saveImgAddrs(json))
      })
    else return fetch(`http://localhost:8080/pictures`)
      .then(
        response => response.json(),
        error => console.log('An error occured.', error)
      )
      .then(json => {
        if(json !== undefined) shuffle(json.pictures)
        dispatch(saveImgAddrs(json))
      })
  }
}

export {types, fetchImgAddr, loadImages, setGalleryId}
